(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{421:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var react=__webpack_require__(1),react_default=__webpack_require__.n(react),axios=__webpack_require__(99),axios_default=__webpack_require__.n(axios),es=__webpack_require__(410),router_es=__webpack_require__(34),react_apollo_browser_umd=__webpack_require__(82),src=__webpack_require__(103),src_default=__webpack_require__.n(src),build=__webpack_require__(407),build_default=__webpack_require__.n(build),Camera=(__webpack_require__(408),function AlertCamera(){var getFileName=function getFileName(imageNum,blobType){var photoNumber=function padWithZeroNumber(num,width){return(num+="").length>=width?num:new Array(width-num.length+1).join("0")+num}(imageNum,4),ext=function getFileExtention(blobType){var ext=build.IMAGE_TYPES.PNG;return"image/jpeg"===blobType&&(ext=build.IMAGE_TYPES.JPG),ext}(blobType);return"".concat("photo","-").concat(photoNumber,".").concat(ext)},downloadImageFile=function downloadImageFile(dataUri,imageNum){!function downloadImageFileFromConverted(blob,imageNum){window.URL=window.webkitURL||window.URL;var anchor=document.createElement("a");anchor.download=getFileName(imageNumber,blob.type),anchor.href=window.URL.createObjectURL(blob);var mouseEvent=document.createEvent("MouseEvents");mouseEvent.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),anchor.dispatchEvent(mouseEvent)}(function dataURItoConvert(dataURI){for(var byteString=atob(dataURI.split(",")[1]),mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],arrBuff=new ArrayBuffer(byteString.length),unitArr=new Uint8Array(arrBuff),i=0;i<byteString.length;++i)unitArr[i]=byteString.charCodeAt(i);return new Blob([arrBuff],{type:mimeString})}(dataUri))},imageNumber=0;return react_default.a.createElement(build_default.a,{onTakePhoto:function onTakePhoto(dataUri){!function onTakePhoto(dataUri){console.log("photo snapped!"),downloadImageFile(dataUri),imageNumber+=1}(dataUri)},onCameraError:function onCameraError(error){!function onCameraError(error){console.error("onCameraError",error)}(error)},idealFacingMode:build.FACING_MODES.ENVIRONMENT,idealResolution:{width:2500,height:3e3},imageType:build.IMAGE_TYPES.JPG,imageCompression:.97,isMaxResolution:!1,isImageMirror:!1,isDisplayStartCameraError:!0,sizeFactor:1,onCameraStart:function onCameraStart(stream){!function onCameraStart(stream){console.log("onCameraStart",stream)}(stream)},onCameraStop:function onCameraStop(){!function onCameraStop(){console.log("Camera stream has ended")}()},autoPlay:!0})}),create_alert_modal=__webpack_require__(251);function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(obj){return typeof obj}:function _typeof(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _templateObject(){var data=function _taggedTemplateLiteral(strings,raw){raw||(raw=strings.slice(0));return Object.freeze(Object.defineProperties(strings,{raw:{value:Object.freeze(raw)}}))}(["\n    mutation CreateAlert($category: String!, $EventId: Int, $latitude: Float!, $longitude: Float!, $notes: String, $photo: String, $photoTag: String) {\n      createAlert(EventId: $EventId, category: $category, latitude: $latitude, longitude: $longitude, notes: $notes, url: $photo, photoTag: $photoTag ) {\n        id\n        category\n        createdAt\n        url\n      }\n    }\n    "]);return _templateObject=function _templateObject(){return data},data}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}var Alert_Alert=function(_Component){function Alert(props){var _this;return function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Alert),(_this=function _possibleConstructorReturn(self,call){return!call||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(Alert).call(this,props))).state={photo:null,photoTag:"",notes:"",modal:""},_this.handleChange=_this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this))),_this.handleDrop=_this.handleDrop.bind(_assertThisInitialized(_assertThisInitialized(_this))),_this.showUploaded=_this.showUploaded.bind(_assertThisInitialized(_assertThisInitialized(_this))),_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(Alert,react["Component"]),function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}(Alert,[{key:"handleChange",value:function handleChange(e){this.setState(function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}({},e.target.name,e.target.value))}},{key:"handleDrop",value:function handleDrop(files){var _this2=this,photoTag=this.state.photoTag,upload=files.map(function(file){var formData=new FormData;return formData.append("file",file),formData.append("tags","".concat(photoTag)),formData.append("upload_preset","pnqbmmuw"),formData.append("api_key","491544247472459"),formData.append("timestamp",Date.now()/1e3|0),axios_default.a.post("https://api.cloudinary.com/v1_1/n3/image/upload",formData,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(res){var photo=_this2.state.photo,data=res.data,photoURL=data.secure_url;_this2.setState({photo:"".concat(photoURL)},function(){console.log("photo url updated",photo)}),console.log(data)})});axios_default.a.all(upload).then(function(){console.log("All photos successfully uploaded")})}},{key:"showUploaded",value:function showUploaded(){var photo=this.state.photo;return null===photo?react_default.a.createElement("p",null," "):react_default.a.createElement("div",{className:"user-photo"},react_default.a.createElement("img",{src:photo,alt:"uploaded",width:"200",height:"150"}),react_default.a.createElement("p",null,"Photo successfully uploaded!"))}},{key:"changeModal",value:function changeModal(view){this.setState({modal:view})}},{key:"renderModal",value:function renderModal(){var _this3=this;if("camera"===this.state.modal)return react_default.a.createElement(create_alert_modal.a,null,react_default.a.createElement("div",{className:"modal-container"},react_default.a.createElement(Camera,{changeModal:this.changeModal.bind(this)}),react_default.a.createElement("button",{type:"button",onClick:function onClick(){return _this3.changeModal("")}},"Exit camera mode")))}},{key:"render",value:function render(){var _this4=this,_this$state=this.state,photo=_this$state.photo,notes=_this$state.notes,photoTag=_this$state.photoTag,_this$props=this.props,category=_this$props.category,latitude=_this$props.latitude,longitude=_this$props.longitude,createAlert=src_default()(_templateObject());return react_default.a.createElement("div",{className:"alert-layout"},react_default.a.createElement("div",{className:"location-info"},react_default.a.createElement("h1",null,"Disaster Type:"," ",category.split(/\s+/).map(function(w){return w[0].toUpperCase()+w.slice(1)}).join(" "))),react_default.a.createElement("div",{className:"photo"},this.renderModal(),react_default.a.createElement("button",{className:"photo-button",type:"button",onClick:function onClick(){return _this4.changeModal("camera")}},"Capture Photo"),react_default.a.createElement("input",{type:"text",name:"photoTag",placeholder:"Add tags for your photos here",onChange:this.handleChange,value:photoTag})),react_default.a.createElement("div",{className:"notes"},react_default.a.createElement("input",{size:"",type:"text",name:"notes",placeholder:"Enter text here",onChange:this.handleChange,value:notes})),react_default.a.createElement(es.a,{className:"dropzone",name:"file",type:"file",onDrop:this.handleDrop,multiple:!0,accept:"image/*"},react_default.a.createElement("p",null,"Drop files or click here to upload")),react_default.a.createElement("div",null,this.showUploaded()),react_default.a.createElement("div",{className:"submit"},react_default.a.createElement(react_apollo_browser_umd.Mutation,{mutation:createAlert,variables:{category:category,latitude:latitude,longitude:longitude,notes:notes,photo:photo,photoTag:photoTag}},function(mutate,_ref){var loading=_ref.loading,error=_ref.error;return loading?react_default.a.createElement("p",null,"Loading..."):error?react_default.a.createElement("p",null,"Error creating alert"):react_default.a.createElement("button",{type:"button",onClick:function onClick(){mutate(),Object(router_es.d)("/")}},"Submit")})))}}]),Alert}();__webpack_exports__.default=Alert_Alert}}]);
//# sourceMappingURL=1.1d98603b1b02d413f6b5.bundle.js.map